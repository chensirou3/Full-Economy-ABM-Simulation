# 场景配置指南

## 概述

ABM 经济体模拟系统支持通过 YAML 配置文件定义不同的经济场景。每个场景可以设置不同的参数来模拟特定的经济环境和政策条件。

## 场景结构

### 基本格式

```yaml
# 场景描述
description: "场景描述文本"

# 世界配置
world:
  seed: 42                    # 随机种子
  grid:
    rows: 100                 # 网格行数
    cols: 100                 # 网格列数
    cell_km: 2.0             # 每格公里数
  generator:
    sea_level: 0.52          # 海平面比例
    mountain_ratio: 0.15     # 山地比例
    city_count: 15           # 城市数量
    road_density: 0.6        # 道路密度
    resource_richness: 1.0   # 资源丰富度
  consistency:
    min_agri_output_per_capita: 1800  # 最低农业产出

# 人口配置
population:
  N: 10000                   # 总人口
  age_structure: "default"   # 年龄结构
  min_subsistence:
    food: 2200               # 最低食物需求
    other: 1.0               # 其他最低需求
  discount_beta: 0.96        # 时间贴现率
  risk_aversion: 0.7         # 风险厌恶系数

# 企业配置
firms:
  sectors: ["agri", "mining", "manu", "services"]  # 产业部门
  price_stickiness: 0.75     # 价格粘性
  capital_depreciation: 0.06 # 资本折旧率
  markup_elasticity: 0.15    # 加成弹性

# 银行配置
banks:
  capital_ratio_floor: 0.08  # 最低资本充足率
  lgd: 0.45                  # 违约损失率
  pd_model: "default"        # 违约概率模型
  interbank_network: true    # 银行间网络

# 政策配置
policy:
  pi_star: 0.02              # 通胀目标
  r_star: 0.025              # 自然利率
  phi_pi: 1.5                # 通胀反应系数
  phi_y: 0.5                 # 产出缺口反应系数
  phi_f: 0.3                 # 金融稳定反应系数
  committee_size: 7          # 央行委员会规模

# 运行配置
runtime:
  mode: "fixed"              # 运行模式：fixed/continuous
  T_end_days: 3650          # 结束天数（10年）
  checkpoint_every_days: 30  # 快照间隔
  render_fps: 60             # 渲染帧率
  max_agents: 50000          # 最大代理数

# 遥测配置
telemetry:
  event_buffer_size: 10000   # 事件缓冲区大小
  metrics_update_interval: 1 # 指标更新间隔
  compress_snapshots: true   # 压缩快照
  log_level: "INFO"          # 日志级别
```

## 内置场景

### 1. 基准场景 (baseline.yml)

**用途**: 作为其他场景的比较基准，模拟正常的经济环境。

**特点**:
- 中等规模人口 (10,000)
- 标准的政策参数
- 平衡的产业结构
- 适中的风险偏好

**适用于**:
- 系统功能测试
- 新功能验证
- 性能基准测试

### 2. 信贷繁荣场景 (credit_boom.yml)

**用途**: 模拟低利率环境下的信贷扩张和金融周期。

**特点**:
- 更低的自然利率 (1%)
- 更低的银行资本要求 (6%)
- 更乐观的风险评估
- 央行对金融稳定关注较少

**预期结果**:
- 初期经济快速增长
- 信贷快速扩张
- 资产价格上涨
- 后期可能出现金融不稳定

**适用于**:
- 金融周期研究
- 宏观审慎政策测试
- 系统性风险分析

### 3. 供给冲击场景 (supply_shock.yml)

**用途**: 模拟石油危机、自然灾害等供给侧冲击。

**特点**:
- 资源相对稀缺 (0.7倍)
- 更高的设备折旧率
- 更保守的风险评估
- 央行对通胀反应更敏感

**预期结果**:
- 通胀上升
- 经济增长放缓
- 失业率上升
- 政策利率上调

**适用于**:
- 供给冲击影响分析
- 滞胀现象研究
- 政策响应机制测试

## 场景设计原则

### 1. 现实性原则
- 参数设置应基于真实经济数据
- 保持内在的经济逻辑一致性
- 考虑参数间的相互关系

### 2. 可比性原则
- 使用基准场景作为比较基准
- 每次只改变少数关键参数
- 保持其他条件相对稳定

### 3. 渐进性原则
- 参数调整幅度适中
- 避免极端参数设置
- 确保模拟能够稳定运行

### 4. 目标导向原则
- 明确场景要验证的假设
- 设置相应的观察指标
- 预期特定的结果模式

## 参数调节指南

### 世界参数

**地图大小** (`grid.rows/cols`):
- 影响计算性能
- 影响空间经济效应
- 建议：50-200 之间

**人口密度**:
- 计算公式：N / (rows × cols × cell_km²)
- 建议：10-1000 人/km²
- 过高会导致性能问题

**城市数量** (`city_count`):
- 影响城市化水平
- 影响空间聚集效应
- 建议：地图大小的 1-5%

### 经济参数

**通胀目标** (`pi_star`):
- 标准值：2% (0.02)
- 低通胀：0-1%
- 高通胀：3-5%

**自然利率** (`r_star`):
- 发达经济体：1-3%
- 新兴经济体：2-5%
- 危机时期：0-1%

**价格粘性** (`price_stickiness`):
- 高粘性：0.8-0.9 (价格调整慢)
- 低粘性：0.5-0.7 (价格调整快)
- 影响通胀动态

**资本充足率** (`capital_ratio_floor`):
- 巴塞尔III：8%
- 保守银行：10-12%
- 宽松环境：6-8%

### 行为参数

**时间贴现率** (`discount_beta`):
- 标准值：0.95-0.97
- 更耐心：0.97-0.99
- 更急躁：0.90-0.95

**风险厌恶** (`risk_aversion`):
- 标准值：0.5-1.0
- 风险喜好：0.2-0.5
- 高度厌恶：1.0-2.0

## 场景验证

### 1. 配置验证
```bash
# 使用 API 验证场景
curl -X GET "http://localhost:8000/scenarios/validate/your_scenario"
```

### 2. 一致性检查
- 人口与资源匹配
- 城市数量合理性
- 参数范围检查
- 经济逻辑一致性

### 3. 稳定性测试
- 模拟是否能正常运行
- 是否出现异常崩溃
- 关键指标是否合理

## 自定义场景创建

### 步骤1：确定研究目标
- 要验证什么假设？
- 关注哪些经济现象？
- 预期什么样的结果？

### 步骤2：选择基准场景
- 从最接近的内置场景开始
- 复制配置文件
- 重命名场景文件

### 步骤3：调整关键参数
- 根据研究目标调整参数
- 一次只改变少数参数
- 记录修改原因

### 步骤4：验证和测试
- 使用验证 API 检查配置
- 运行短期测试
- 检查关键指标

### 步骤5：文档化
- 记录场景目的
- 说明参数选择理由
- 描述预期结果

## 场景管理

### 文件命名规范
```
scenarios/
├── baseline.yml          # 基准场景
├── credit_boom.yml       # 信贷繁荣
├── supply_shock.yml      # 供给冲击
├── high_inflation.yml    # 高通胀环境
├── recession.yml         # 经济衰退
└── custom_scenario.yml   # 自定义场景
```

### 版本控制
- 使用 Git 管理场景文件
- 为重要场景创建标签
- 记录场景变更历史

### 场景共享
- 导出场景配置
- 分享研究场景
- 建立场景库

## 高级功能

### 参数扫描
```python
# 批量创建参数变化的场景
for pi_star in [0.01, 0.02, 0.03, 0.04]:
    create_scenario(f"inflation_target_{pi_star}", 
                   base_scenario="baseline",
                   overrides={"policy.pi_star": pi_star})
```

### 场景对比
- 并行运行多个场景
- 对比关键指标
- 统计显著性测试

### 敏感性分析
- 系统性改变参数
- 观察结果变化
- 识别关键参数

## 故障排除

### 常见问题

**1. 配置验证失败**
- 检查 YAML 语法
- 验证参数范围
- 确认必需字段

**2. 模拟运行缓慢**
- 减少人口规模
- 降低地图大小
- 调整快照频率

**3. 结果不符合预期**
- 检查参数设置
- 延长运行时间
- 查看详细日志

**4. 内存不足**
- 减少代理数量
- 增加快照清理频率
- 优化事件缓冲区

### 调试技巧
- 使用小规模测试场景
- 启用详细日志
- 监控关键指标变化
- 对比基准场景结果

---

通过合理的场景设计和参数调节，可以模拟各种复杂的经济环境，为经济学研究和政策分析提供强有力的工具。
